  
<!-- ********************************************************************* -->
<!--                                                                       -->
<!-- build-war.xml                                             17 jun 2012 -->
<!--                                                                       -->
<!-- ********************************************************************* -->

  <property name="build.war.dir"     value="${build.dir}/war" />
  <property name="build.webinf.dir"  value="${build.war.dir}/WEB-INF" />
  <property name="build.lib.dir"     value="${build.war.dir}/WEB-INF/lib" />

  <property name="src.war.dir"       value="war" />
  <property name="src.config.dir"    value="config" />
  <property name="src.lib.dir"       value="lib" />
  <property name="jakarta.lib.dir"   value="${lib.dir}/jakarta" />

  <property name="war.path"         value="${build.dist.dir}/${app.name}.war"/>

<!-- ============================================================== -->

  <target name="build.war" depends="build.jar,assemble.war" 
          description="Build the WAR" >
    <delete file="${war.path}" />
    <jar jarfile="${war.path}" >
      <fileset dir="${build.war.dir}" includes="**/*" />
    </jar>
    <echo message="WAR file: ${war.path}" />
  </target>
  
  <target name="assemble.war" 
          depends="copy.jars,copy.config,create.rest.vendor.file" >

    <copy todir="${build.war.dir}" preservelastmodified="true">
       <fileset dir="${src.war.dir}" includes="**"/>
    </copy>

   <copy file="${src.war.dir}/WEB-INF/${rest.vendor}-web.xml" 
         tofile="${build.war.dir}/WEB-INF/web.xml"/>

    <copy todir="${build.webinf.dir}/lib" preservelastmodified="true"
      file="${build.dist.dir}/${app.name}.jar" />

  </target>

<!-- ============================================================ -->

  <target name="copy.jars"  
          depends="copy.spring.jars, copy.jakarta.jars, copy.rest.jars" >
  </target>

  <target name="copy.spring.jars"  >
    <copy todir="${build.webinf.dir}/lib" preservelastmodified="true">
      <fileset dir="${lib.dir}/spring" includes="*.jar" />
    </copy >
    <copy todir="${build.webinf.dir}/lib" preservelastmodified="true">
      <fileset dir="${lib.dir}/misc" includes="*.jar" />
    </copy >
  </target>

  <target name="copy.jakarta.jars"  >
    <copy todir="${build.webinf.dir}/lib" preservelastmodified="true"
          file="${jakarta.lib.dir}/commons-lang.jar" />
    <copy todir="${build.webinf.dir}/lib" preservelastmodified="true"
          file="${jakarta.lib.dir}/commons-logging.jar" />
    <copy todir="${build.webinf.dir}/lib" preservelastmodified="true"
          file="${jakarta.lib.dir}/log4j-1.2.14.jar" />
    <copy todir="${build.webinf.dir}/lib" preservelastmodified="true"
          file="${jakarta.lib.dir}/commons-logging.jar" />
  </target>

<!-- Config -->

  <target name="copy.config"  >

    <copy todir="${build.war.dir}" preservelastmodified="true">
      <fileset dir="${src.config.dir}" > <include name="*.xsd" /> </fileset>
    </copy>
    <copy todir="${build.war.dir}/WEB-INF/classes" preservelastmodified="true">
      <fileset dir="${src.config.dir}" > <include name="*.xsd" /> </fileset>
    </copy>

    <copy todir="${build.war.dir}/WEB-INF/classes" preservelastmodified="true">
      <fileset dir="${src.config.dir}" > <include name="*.xml" /> </fileset>
      <fileset dir="${src.config.dir}" > <include name="*.properties" /> </fileset>
    </copy>

    <copy todir="${build.war.dir}/WEB-INF/classes" preservelastmodified="true">
      <fileset dir="${src.config.dir}/${rest.vendor}" > <include name="*.xml" /> </fileset>
      <fileset dir="${src.config.dir}/${rest.vendor}" > <include name="*.properties" /> </fileset>
    </copy>
  </target>

<!-- REST Vendors -->

  <target name="copy.rest.jars"  >
     <antcall target="copy.${rest.vendor}.jars" />
  </target>

  <target name="copy.cxf.jars" >
    <copy todir="${build.webinf.dir}/lib" preservelastmodified="true">
      <fileset dir="${lib.dir}/cxf-jaxrs" includes="*.jar" />
    </copy >
  </target>

  <target name="copy.jersey.jars" >
    <copy todir="${build.webinf.dir}/lib" preservelastmodified="true">
      <fileset dir="${jersey.home.dir}/lib" includes="*.jar" />
    </copy >
  </target>

  <target name="copy.resteasy.jars" >
    <copy todir="${build.webinf.dir}/lib" preservelastmodified="true">
      <fileset dir="${resteasy.home.dir}/lib" includes="*.jar" />
    </copy >
  </target>

<!-- ============================================================== -->

  <target name="clean.war" >
    <delete dir="${build.dir}" />
    <mkdir dir="${build.dir}" />
    <mkdir dir="${build.war.dir}" />
    <mkdir dir="${build.dist.dir}/" />
    <mkdir dir="${build.classes.dir}/" />
    <mkdir dir="${build.webinf.dir}" />
  </target>

  <target name="deploy.war"  
                description="Deploy War to tomcat webapp"  >
    <copy todir="${deploy.dir}" preservelastmodified="true"
           file="${war.path}" />
  </target>

  <!-- ======================================================= -->
  <!-- init                                                    -->
  <!-- ======================================================= -->

  <target name="create.rest.vendor.file" depends="" >
    <property name="rest.vendor.file" value="${build.war.dir}/rest-vendor.txt" />
    <delete file="${rest.vendor.file}" />
    <echo message="REST VENDOR: ${rest.vendor}" />
    <echo file="${rest.vendor.file}">REST VENDOR: ${rest.vendor}</echo>
  </target>

  <target name="create.build.timestamp.file" depends="create.build.timestamp" >
    <property name="build.timestamp.file" value="${build.war.dir}/timestamp.txt" />
    <delete file="${build.timestamp.file}" />
    <echo message="BUILD VERSION=${timestamp.build}" />
    <echo file="${build.timestamp.file}">Build Timestamp: ${timestamp.build}</echo>
  </target>

  <target name="create.build.timestamp" >
    <tstamp>
      <format property="timestamp.build" pattern="d-MMM-yyyy HH:mm:ss"/>
    </tstamp>
  </target>

