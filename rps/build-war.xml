  
<!-- ********************************************************************* -->
<!--                                                                       -->
<!-- build-war.xml                                                         -->
<!--                                                                       -->
<!-- ********************************************************************* -->

  <property name="build.classes.dir" value="${build.dir}/classes" />
  <property name="build.war.dir"     value="${build.dir}/war" />
  <property name="build.webinf.dir"  value="${build.war.dir}/WEB-INF" />
  <property name="build.lib.dir"     value="${build.war.dir}/WEB-INF/lib" />

  <property name="src.war.dir"       value="war" />
  <property name="src.config.dir"    value="config" />
  <property name="src.lib.dir"       value="lib" />

  <property name="war.path"          value="${build.dist.dir}/${app.name}.war"/>

  <property name="override.dir"      value="${override.dir}" />

<!-- ============================================================== -->

  <target name="build.war" depends="build.jar,assemble.war" 
          description="Build the WAR" >
    <delete file="${war.path}" />
    <jar jarfile="${war.path}" >
      <fileset dir="${build.war.dir}" includes="**/*" />
    </jar>
  </target>
  
  <target name="assemble.war" 
          depends="copy.jars,copy.config,create.rest.vendor.file" >

    <copy todir="${build.war.dir}" preservelastmodified="true">
       <fileset dir="${src.war.dir}" includes="**"/>
    </copy>

   <copy file="${src.war.dir}/WEB-INF/${rest.vendor}-web.xml" 
         tofile="${build.war.dir}/WEB-INF/web.xml"/>

    <copy todir="${build.webinf.dir}/lib" preservelastmodified="true"
      file="${build.dist.dir}/${app.name}.jar" />

  </target>

<!-- ============================================================ -->

  <target name="copy.jars"  depends="" >
    <copy todir="${build.webinf.dir}/lib" preservelastmodified="true" flatten="yes" >
      <fileset dir="${lib.dir}/common" includes="**/*.jar" />
      <fileset dir="${lib.dir}/server" includes="**/*.jar" />
    </copy >
  </target>

  <target name="copy.config"  >

    <copy todir="${build.war.dir}/WEB-INF/classes" preservelastmodified="true">
      <fileset dir="${src.config.dir}" > <include name="*.xml" /> </fileset>
      <fileset dir="${src.config.dir}" > <include name="*.properties" /> </fileset>
    </copy>

    <copy todir="${build.war.dir}/WEB-INF/classes" preservelastmodified="true">
      <fileset dir="${src.config.dir}/${daoProvider}" > <include name="*.xml" /> </fileset>
      <fileset dir="${src.config.dir}/${daoProvider}" > <include name="*.properties" /> </fileset>
    </copy>

    <copy todir="${build.war.dir}/WEB-INF/classes" preservelastmodified="true">
      <fileset dir="${src.config.dir}/${rest.vendor}" > <include name="*.xml" /> </fileset>
      <fileset dir="${src.config.dir}/${rest.vendor}" > <include name="*.properties" /> </fileset>
    </copy>

    <copy todir="${build.war.dir}/rest-vendor" preservelastmodified="true">
      <fileset dir="${src.config.dir}/${rest.vendor}" > <include name="*.xml" /> </fileset>
      <fileset dir="${src.config.dir}/${rest.vendor}" > <include name="*.properties" /> </fileset>
    </copy>

  </target>

<!-- ============================================================== -->

  <target name="clean.war" >
    <delete dir="${build.dir}" />
    <mkdir dir="${build.dir}" />
    <mkdir dir="${build.war.dir}" />
    <mkdir dir="${build.dist.dir}/" />
    <mkdir dir="${build.classes.dir}/" />
    <mkdir dir="${build.webinf.dir}" />
  </target>

  <target name="deploy.war"  
                description="Deploy War to tomcat webapp"  >
    <copy todir="${deploy.dir}" preservelastmodified="true"
           file="${war.path}" />
  </target>

  <!-- ======================================================= -->
  <!-- init                                                    -->
  <!-- ======================================================= -->

  <target name="create.rest.vendor.file" depends="" >
    <property name="rest.vendor.file" value="${build.war.dir}/rest-vendor.txt" />
    <delete file="${rest.vendor.file}" />
    <echo message="REST VENDOR: ${rest.vendor}" />
    <echo file="${rest.vendor.file}">REST VENDOR: ${rest.vendor}</echo>
  </target>

  <target name="create.build.timestamp.file" depends="create.build.timestamp" >
    <property name="build.timestamp.file" value="${build.war.dir}/timestamp.txt" />
    <delete file="${build.timestamp.file}" />
    <echo message="BUILD VERSION=${timestamp.build}" />
    <echo file="${build.timestamp.file}">Build Timestamp: ${timestamp.build}</echo>
  </target>

  <target name="create.build.timestamp" >
    <tstamp>
      <format property="timestamp.build" pattern="d-MMM-yyyy HH:mm:ss"/>
    </tstamp>
  </target>

