  <!-- Properties -->

  <property name="build.test.classes.dir" value="${build.dir}/test-classes" />
  <property name="test.output.dir"        value="${build.dir}/test-output"/>
  <property name="testng.file"            value="testng.xml" />

  <property name="src.test.dir"           value="${basedir}/test" />
  <property name="src.test.config.dir"    value="${src.config.dir}/test" />
  <property name="title"                  value="" />

  <!-- Classpaths -->

  <path id="test.classpath">
    <path refid="compile.classpath"/>
    <pathelement location="${build.classes.dir}"/>
    <pathelement location="${build.test.classes.dir}"/>
    <pathelement location="${testng.jar}"/>
  </path>

  <path id="test.runtime.classpath">
    <path refid="compile.classpath"/>
    <pathelement location="${src.config.dir}" />
    <pathelement location="${src.test.config.dir}" />
    <pathelement location="${build.classes.dir}"/>
    <pathelement location="${build.test.classes.dir}"/>
    <pathelement location="config" />
    <pathelement location="config/client" />
    <pathelement location="config/test" />
    <pathelement location="config/${daoProvider}" />
    <fileset dir="${lib.dir}"   includes="reportng/**/*.jar" />
    <fileset dir="${lib.dir}"   includes="jakarta/*.jar" />
  </path>

  <!-- Test targets -->

   <target  name="test" description="Run tests" 
            depends="compile">
      <mkdir dir="${test.output.dir}"/>
      <taskdef name="testng" 
         classpathref="test.classpath" 
         classname="com.beust.testng.TestNGAntTask"/>
      <testng
         classpathref="test.runtime.classpath"
         listeners="org.uncommons.reportng.HTMLReporter"
         outputdir="${test.output.dir}">
         <sysproperty key="org.uncommons.reportng.show-expected-exception" value="true" />
         <sysproperty key="org.uncommons.reportng.title" value="RPS Test Report - ${title}"/>
         <xmlfileset dir="${basedir}" includes="${testng.file}"/>
      </testng>
      <echo>See ${test.output.dir}/index.html for report</echo>
   </target>

   <target  name="echo.test" >
     <echo message="Properties" />
     <echo message="  basedir=${basedir}" />
     <echo message="  build.test.classes.dir=${build.test.classes.dir}" />
     <echo message="  test.output.dir      =${test.output.dir}" />
   </target>

  <pathconvert property="test.runtime.classpath.string" refid="test.runtime.classpath"
     pathsep="${line.separator}    " />
  <target name="echo.test.cp" description="Echo test.runtime.classpath" >
    <echo message="CLASSPATH:" />
    <echo message="  test.runtime.classpath  = ${test.runtime.classpath.string}" />
  </target>
